---
/**
 * CookieBanner Component
 * GENERATIVA - AI Agents Platform
 *
 * Modern, minimal cookie consent banner
 *
 * Design principles (2025-2026 best practices):
 * - Corner popup style (doesn't block content)
 * - Button parity (GDPR compliant - equal visual weight)
 * - Minimal, conversational language
 * - Subtle fade-in animation
 * - Mobile-first responsive
 * - No dark patterns
 *
 * Sources:
 * - https://secureprivacy.ai/blog/cookie-banner-design-2026
 * - https://cookieinformation.com/blog/designing-compliant-cookie-banners/
 * - https://www.enzuzo.com/learn/best-cookie-banner-examples
 */

import type { Locale } from '@i18n/index';

interface Props {
  locale: Locale;
}

const { locale } = Astro.props;

// Shorter, friendlier text for minimal design
const content = {
  ro: {
    title: 'Cookie-uri',
    description: 'Folosim cookie-uri pentru a-ți îmbunătăți experiența.',
    accept: 'Accept',
    reject: 'Refuz'
  },
  en: {
    title: 'Cookies',
    description: 'We use cookies to improve your experience.',
    accept: 'Accept',
    reject: 'Decline'
  }
};

const text = content[locale];
---

<div
  id="cookie-banner"
  class="cookie-banner"
  role="dialog"
  aria-labelledby="cookie-title"
  aria-describedby="cookie-description"
  data-cookie-banner
>
  <!-- Cookie icon -->
  <div class="cookie-icon" aria-hidden="true">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="w-5 h-5">
      <circle cx="12" cy="12" r="10"/>
      <circle cx="8" cy="9" r="1" fill="currentColor"/>
      <circle cx="15" cy="8" r="1" fill="currentColor"/>
      <circle cx="10" cy="14" r="1" fill="currentColor"/>
      <circle cx="16" cy="13" r="1" fill="currentColor"/>
      <circle cx="7" cy="12" r="0.5" fill="currentColor"/>
      <circle cx="13" cy="16" r="0.5" fill="currentColor"/>
    </svg>
  </div>

  <!-- Content -->
  <div class="cookie-content">
    <p id="cookie-title" class="sr-only">{text.title}</p>
    <p id="cookie-description" class="cookie-text">
      {text.description}
    </p>
  </div>

  <!-- Buttons - Equal visual weight (GDPR compliant) -->
  <div class="cookie-buttons">
    <button
      type="button"
      class="cookie-btn cookie-btn-secondary"
      data-action="reject"
    >
      {text.reject}
    </button>
    <button
      type="button"
      class="cookie-btn cookie-btn-primary"
      data-action="accept"
    >
      {text.accept}
    </button>
  </div>
</div>

<style>
  .cookie-banner {
    /* Position - corner popup (left bottom) */
    position: fixed;
    bottom: 1rem;
    left: 1rem;
    z-index: 50;

    /* Size - compact */
    max-width: 320px;
    width: calc(100% - 2rem);

    /* Layout */
    display: flex;
    flex-direction: column;
    gap: 0.75rem;

    /* Appearance */
    background: white;
    border-radius: 1rem;
    padding: 1rem;

    /* Subtle shadow */
    box-shadow:
      0 4px 6px -1px rgba(0, 0, 0, 0.1),
      0 2px 4px -2px rgba(0, 0, 0, 0.1),
      0 0 0 1px rgba(0, 0, 0, 0.05);

    /* Initial state - hidden */
    opacity: 0;
    visibility: hidden;
    transform: translateY(1rem) scale(0.95);

    /* Smooth animation */
    transition:
      opacity 0.3s ease,
      visibility 0.3s ease,
      transform 0.3s ease;
  }

  /* Visible state */
  .cookie-banner.visible {
    opacity: 1;
    visibility: visible;
    transform: translateY(0) scale(1);
  }

  /* Cookie icon */
  .cookie-icon {
    display: flex;
    align-items: center;
    justify-content: center;
    width: 2.5rem;
    height: 2.5rem;
    background: linear-gradient(135deg, #FFFBEB 0%, #F1F5F9 100%);
    border-radius: 0.75rem;
    color: #D97706;
    flex-shrink: 0;
  }

  /* Content */
  .cookie-content {
    flex: 1;
  }

  .cookie-text {
    font-size: 0.875rem;
    line-height: 1.4;
    color: #525252;
    margin: 0;
  }

  /* Buttons container */
  .cookie-buttons {
    display: flex;
    gap: 0.5rem;
  }

  /* Base button styles - EQUAL VISUAL WEIGHT */
  .cookie-btn {
    flex: 1;
    padding: 0.625rem 1rem;
    font-size: 0.875rem;
    font-weight: 500;
    border-radius: 0.5rem;
    cursor: pointer;
    transition: all 0.2s ease;
    border: none;
  }

  /* Primary button (Accept) — flat amber */
  .cookie-btn-primary {
    background: #F59E0B;
    color: white;
  }

  .cookie-btn-primary:hover {
    background: #D97706;
    box-shadow: 0 4px 12px rgba(245, 158, 11, 0.3);
    transform: translateY(-1px);
  }

  /* Secondary button (Reject) - Same size, similar prominence */
  .cookie-btn-secondary {
    background: #f5f5f5;
    color: #525252;
  }

  .cookie-btn-secondary:hover {
    background: #e5e5e5;
    color: #262626;
  }

  /* Focus states */
  .cookie-btn:focus {
    outline: none;
  }

  .cookie-btn:focus-visible {
    outline: 2px solid #F59E0B;
    outline-offset: 2px;
  }

  /* Tablet and up - horizontal layout */
  @media (min-width: 400px) {
    .cookie-banner {
      flex-direction: row;
      flex-wrap: wrap;
      align-items: center;
      gap: 0.75rem;
      max-width: 400px;
    }

    .cookie-icon {
      width: 2.25rem;
      height: 2.25rem;
    }

    .cookie-content {
      flex: 1;
      min-width: 0;
    }

    .cookie-buttons {
      width: 100%;
    }
  }

  /* Desktop - more spacing */
  @media (min-width: 640px) {
    .cookie-banner {
      bottom: 1.5rem;
      left: 1.5rem;
      padding: 1.25rem;
    }
  }

  /* Large screens */
  @media (min-width: 1024px) {
    .cookie-banner {
      bottom: 2rem;
      left: 2rem;
    }
  }

  /* Reduced motion */
  @media (prefers-reduced-motion: reduce) {
    .cookie-banner {
      transition: opacity 0.15s ease;
      transform: none;
    }

    .cookie-banner.visible {
      transform: none;
    }

    .cookie-btn:hover {
      transform: none;
    }
  }
</style>

<script>
  // Cookie consent management
  const COOKIE_NAME = 'generativa_cookie_consent';
  const COOKIE_DURATION = 365; // days

  function getCookie(name: string): string | null {
    const value = `; ${document.cookie}`;
    const parts = value.split(`; ${name}=`);
    if (parts.length === 2) {
      return parts.pop()?.split(';').shift() || null;
    }
    return null;
  }

  function setCookie(name: string, value: string, days: number): void {
    const date = new Date();
    date.setTime(date.getTime() + days * 24 * 60 * 60 * 1000);
    const expires = `expires=${date.toUTCString()}`;
    document.cookie = `${name}=${value};${expires};path=/;SameSite=Lax`;
  }

  function showBanner(): void {
    const banner = document.getElementById('cookie-banner');
    if (banner) {
      banner.classList.add('visible');
    }
  }

  function hideBanner(): void {
    const banner = document.getElementById('cookie-banner');
    if (banner) {
      banner.classList.remove('visible');
      // Dispatch custom event so other components (like ScrollToTop) know banner is hidden
      window.dispatchEvent(new CustomEvent('cookieBannerHidden'));
    }
  }

  function handleConsent(accepted: boolean): void {
    setCookie(COOKIE_NAME, accepted ? 'accepted' : 'rejected', COOKIE_DURATION);
    hideBanner();

    if (accepted) {
      // Enable analytics if accepted
      // TODO: Initialize analytics here when configured
      console.log('Cookie consent: accepted - analytics enabled');
    } else {
      console.log('Cookie consent: rejected - analytics disabled');
    }
  }

  // Initialize
  document.addEventListener('DOMContentLoaded', () => {
    const consent = getCookie(COOKIE_NAME);

    if (!consent) {
      // Show banner after a short delay for better UX
      setTimeout(showBanner, 1000);
    } else {
      // Cookie already set, dispatch event so ScrollToTop knows
      window.dispatchEvent(new CustomEvent('cookieBannerHidden'));
    }

    // Handle button clicks
    document.querySelectorAll('[data-action]').forEach((button) => {
      button.addEventListener('click', () => {
        const action = (button as HTMLElement).dataset.action;
        handleConsent(action === 'accept');
      });
    });
  });
</script>
