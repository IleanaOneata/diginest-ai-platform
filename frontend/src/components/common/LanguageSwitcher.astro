---
/**
 * LanguageSwitcher Component
 *
 * Toggle pill compact for switching between Romanian and English.
 * Active language has brand gradient, inactive is a clickable link.
 * Handles path translation between locales (e.g., /en/about/ -> /ro/despre/)
 */

import { type Locale, getAlternateLocale, buildAlternatePath } from '@i18n/index';

interface Props {
  locale: Locale;
  currentPath: string;
}

const { locale, currentPath } = Astro.props;
const alternateLocale = getAlternateLocale(locale);
const alternatePath = buildAlternatePath(currentPath, locale, alternateLocale);
---

<nav class="flex items-center bg-neutral-100 rounded-full p-0.5 border border-neutral-200/80"
     role="navigation"
     aria-label="Language switcher">
  {locale === 'ro' ? (
    <>
      <span class="px-3 py-1 text-xs font-semibold tracking-wide text-white
                    bg-gradient-to-r from-primary-500 to-accent-600
                    rounded-full shadow-sm" lang="ro" aria-current="true">
        RO
      </span>
      <a href={alternatePath}
         class="px-3 py-1 text-xs font-semibold tracking-wide text-neutral-500
                hover:text-neutral-700 rounded-full transition-colors duration-200 lang-switch-link"
         lang="en" aria-label="Switch to English">
        EN
      </a>
    </>
  ) : (
    <>
      <a href={alternatePath}
         class="px-3 py-1 text-xs font-semibold tracking-wide text-neutral-500
                hover:text-neutral-700 rounded-full transition-colors duration-200 lang-switch-link"
         lang="ro" aria-label="Schimb&#259; &#238;n Rom&#226;n&#259;">
        RO
      </a>
      <span class="px-3 py-1 text-xs font-semibold tracking-wide text-white
                    bg-gradient-to-r from-primary-500 to-accent-600
                    rounded-full shadow-sm" lang="en" aria-current="true">
        EN
      </span>
    </>
  )}
</nav>

<script>
  // Preserve scroll position when switching language
  (function() {
    function init() {
      // On page load: restore scroll position if coming from a language switch
      const savedScroll = sessionStorage.getItem('langSwitchScroll');
      if (savedScroll) {
        sessionStorage.removeItem('langSwitchScroll');
        const scrollPercent = parseFloat(savedScroll);
        // Wait for page to fully render before restoring position
        requestAnimationFrame(() => {
          const maxScroll = document.documentElement.scrollHeight - window.innerHeight;
          const targetY = Math.round(scrollPercent * maxScroll);
          window.scrollTo(0, targetY);
        });
      }

      // On click: save scroll position before navigating
      document.querySelectorAll('.lang-switch-link').forEach((link) => {
        link.addEventListener('click', () => {
          const maxScroll = document.documentElement.scrollHeight - window.innerHeight;
          const scrollPercent = maxScroll > 0 ? window.scrollY / maxScroll : 0;
          sessionStorage.setItem('langSwitchScroll', String(scrollPercent));
        });
      });
    }

    document.addEventListener('DOMContentLoaded', init);
    document.addEventListener('astro:page-load', init);
  })();
</script>
