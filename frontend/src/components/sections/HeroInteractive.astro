---
/**
 * Interactive Hero Section - GENERATIVA
 *
 * Abordare "Demo-First": Vizitatorii văd AI-ul în acțiune în primele 5 secunde.
 *
 * Layout:
 * - Stânga: Headline + subheadline + CTA
 * - Dreapta: Chat Simulator interactiv
 *
 * Diferențiere vs competiție:
 * - Agentic.ro: grafică abstractă cu orbite → noi: demo real
 * - Inflate: video → noi: interactiv (mai engaging)
 */

import { getTranslations, type Locale, buildLocalePath } from '@i18n/index';
import Button from '@components/common/Button.astro';
import ChatSimulator from '@components/demo/ChatSimulator.astro';

interface Props {
  locale: Locale;
}

const { locale } = Astro.props;
const t = getTranslations(locale);

// Texte specifice pentru Hero interactiv
const heroTexts = {
  ro: {
    eyebrow: 'Vezi AI-ul în acțiune',
    headline: 'Agenți AI care răspund clienților tăi',
    headlineAccent: '24/7',
    subheadline: 'În timp ce tu citești asta, demo-ul nostru arată cum un agent AI rezolvă o cerere de suport în 30 de secunde. Fără pauze, fără erori, fără ore suplimentare.',
    cta_primary: 'Vreau și eu așa ceva',
    cta_secondary: 'Cum funcționează?',
    stats: [
      { value: '0.8', unit: 's', label: 'timp răspuns', icon: 'bolt' },
      { value: '24', unit: '/7', label: 'disponibilitate', icon: 'clock' },
      { value: '90', unit: '%', label: 'rezolvate automat', icon: 'check' },
    ],
  },
  en: {
    eyebrow: 'See AI in action',
    headline: 'AI Agents that respond to your customers',
    headlineAccent: '24/7',
    subheadline: 'While you\'re reading this, our demo shows how an AI agent resolves a support request in 30 seconds. No breaks, no errors, no overtime.',
    cta_primary: 'I want this too',
    cta_secondary: 'How does it work?',
    stats: [
      { value: '0.8', unit: 's', label: 'response time', icon: 'bolt' },
      { value: '24', unit: '/7', label: 'availability', icon: 'clock' },
      { value: '90', unit: '%', label: 'auto-resolved', icon: 'check' },
    ],
  },
};

const hero = heroTexts[locale] || heroTexts.ro;
---

<section class="relative overflow-hidden bg-gradient-to-br from-neutral-50 via-white to-primary-50/30 min-h-[90vh] flex items-center">
  <!-- Subtle background elements -->
  <div class="absolute inset-0 bg-grid opacity-20"></div>
  <div class="absolute top-20 right-1/4 w-72 h-72 bg-primary-400/10 rounded-full blur-3xl"></div>
  <div class="absolute bottom-20 left-1/4 w-96 h-96 bg-accent-500/10 rounded-full blur-3xl"></div>

  <div class="relative py-16 md:py-20 lg:py-24 max-w-6xl mx-auto px-4 sm:px-6 lg:px-8">
    <div class="grid lg:grid-cols-[1fr_auto] gap-8 lg:gap-10 items-center">
      <!-- Left: Content -->
      <div class="order-2 lg:order-1">
        <!-- Eyebrow -->
        <div class="inline-flex items-center gap-2 px-4 py-2 bg-primary-100/80 text-primary-700 rounded-full text-sm font-medium mb-6 animate-fade-in backdrop-blur-sm">
          <span class="relative flex h-2 w-2">
            <span class="animate-ping absolute inline-flex h-full w-full rounded-full bg-primary-400 opacity-75"></span>
            <span class="relative inline-flex rounded-full h-2 w-2 bg-primary-500"></span>
          </span>
          {hero.eyebrow}
        </div>

        <!-- Headline -->
        <h1 class="text-4xl md:text-5xl lg:text-6xl font-bold text-neutral-900 mb-6 animate-slide-up leading-tight">
          {hero.headline}
          <span class="bg-gradient-to-r from-primary-400 to-accent-600 bg-clip-text text-transparent">
            {' '}{hero.headlineAccent}
          </span>
        </h1>

        <!-- Subheadline -->
        <p class="text-lg md:text-xl text-neutral-600 mb-8 leading-relaxed animate-slide-up max-w-xl" style="animation-delay: 100ms;">
          {hero.subheadline}
        </p>

        <!-- CTAs -->
        <div class="flex flex-col sm:flex-row items-start gap-4 mb-10 animate-slide-up" style="animation-delay: 200ms;">
          <Button
            href={buildLocalePath('/contact/', locale)}
            variant="gradient"
            size="lg"
          >
            {hero.cta_primary}
            <svg class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 8l4 4m0 0l-4 4m4-4H3" />
            </svg>
          </Button>
          <Button
            href="#how-it-works"
            variant="ghost"
            size="lg"
          >
            {hero.cta_secondary}
            <svg class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
            </svg>
          </Button>
        </div>

        <!-- Stats Cards - Glassmorphism Style -->
        <div class="flex flex-wrap gap-3 sm:gap-4 animate-fade-in" style="animation-delay: 400ms;">
          {hero.stats.map((stat) => (
            <div class="stat-card group relative flex items-center gap-3 px-4 py-3 sm:px-5 sm:py-3.5 bg-white/60 backdrop-blur-sm border border-neutral-200/60 rounded-xl hover:border-primary-300/60 hover:bg-white/80 transition-all duration-300 hover:shadow-lg hover:shadow-primary-500/10 cursor-default">
              <!-- Icon -->
              <div class="stat-icon flex-shrink-0 w-9 h-9 sm:w-10 sm:h-10 rounded-lg bg-gradient-to-br from-primary-400/20 to-accent-500/20 flex items-center justify-center group-hover:from-primary-400/30 group-hover:to-accent-500/30 transition-all duration-300">
                {stat.icon === 'bolt' && (
                  <svg class="w-5 h-5 text-primary-600" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M13 10V3L4 14h7v7l9-11h-7z" />
                  </svg>
                )}
                {stat.icon === 'clock' && (
                  <svg class="w-5 h-5 text-primary-600" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                    <circle cx="12" cy="12" r="10" />
                    <polyline points="12 6 12 12 16 14" />
                  </svg>
                )}
                {stat.icon === 'check' && (
                  <svg class="w-5 h-5 text-primary-600" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
                  </svg>
                )}
              </div>

              <!-- Value + Label -->
              <div class="flex flex-col">
                <div class="flex items-baseline gap-0.5">
                  <span class="stat-value text-2xl sm:text-3xl font-bold bg-gradient-to-r from-primary-500 via-primary-600 to-accent-600 bg-clip-text text-transparent">
                    {stat.value}
                  </span>
                  <span class="text-lg sm:text-xl font-semibold text-neutral-700">
                    {stat.unit}
                  </span>
                </div>
                <span class="text-xs sm:text-sm text-neutral-500 font-medium -mt-0.5">
                  {stat.label}
                </span>
              </div>

              <!-- Subtle glow on hover -->
              <div class="absolute inset-0 rounded-xl bg-gradient-to-r from-primary-400/0 via-primary-400/0 to-accent-500/0 group-hover:from-primary-400/5 group-hover:via-transparent group-hover:to-accent-500/5 transition-all duration-500 pointer-events-none"></div>
            </div>
          ))}
        </div>
      </div>

      <!-- Right: Chat Simulator -->
      <div class="order-1 lg:order-2 flex justify-center lg:justify-end animate-fade-in" style="animation-delay: 300ms;">
        <div class="relative">
          <!-- Decorative elements behind chat -->
          <div class="absolute -top-4 -left-4 w-full h-full bg-gradient-to-br from-primary-400/20 to-accent-500/20 rounded-2xl transform rotate-3"></div>
          <div class="absolute -bottom-4 -right-4 w-full h-full bg-gradient-to-br from-accent-400/20 to-primary-500/20 rounded-2xl transform -rotate-3"></div>

          <!-- Chat Simulator (includes Voice Widget in footer) -->
          <div class="relative z-10">
            <ChatSimulator locale={locale} autoPlay={true} />
          </div>

          <!-- Floating badges -->
          <div class="absolute -top-2 -right-2 bg-white px-3 py-1.5 rounded-full shadow-lg text-xs font-medium text-primary-600 animate-bounce z-20">
            Live Demo
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Subtle bottom fade -->
  <div class="absolute bottom-0 left-0 right-0 h-24 bg-gradient-to-t from-white to-transparent"></div>
</section>

<style>
  .bg-grid {
    background-image: radial-gradient(circle, #e5e7eb 1px, transparent 1px);
    background-size: 24px 24px;
  }

  /* Stat cards hover lift effect */
  .stat-card {
    transform: translateY(0);
  }

  .stat-card:hover {
    transform: translateY(-2px);
  }

  /* Counter animation for stat values */
  .stat-value {
    font-variant-numeric: tabular-nums;
  }

  /* Subtle pulse on icon when card is hovered */
  .stat-card:hover .stat-icon {
    animation: icon-pulse 0.6s ease-out;
  }

  @keyframes icon-pulse {
    0% { transform: scale(1); }
    50% { transform: scale(1.1); }
    100% { transform: scale(1); }
  }
</style>

<script>
  /**
   * Counter Animation for Hero Stats
   * Animates numbers from 0 to their final value when they come into view
   */
  (function() {
    'use strict';

    const statValues = document.querySelectorAll('.stat-value');
    if (!statValues.length) return;

    // Store original values and mark as not yet animated
    const statsData: { el: Element; target: string; animated: boolean }[] = [];

    statValues.forEach((el) => {
      const target = el.textContent || '';
      statsData.push({ el, target, animated: false });
    });

    /**
     * Animate a number from 0 to target
     */
    function animateValue(el: Element, targetStr: string, duration: number = 1500): void {
      // Parse the target - handle decimals like "0.8"
      const targetNum = parseFloat(targetStr);
      if (isNaN(targetNum)) {
        el.textContent = targetStr;
        return;
      }

      const isDecimal = targetStr.includes('.');
      const decimalPlaces = isDecimal ? (targetStr.split('.')[1]?.length || 1) : 0;
      const startTime = performance.now();

      function update(currentTime: number): void {
        const elapsed = currentTime - startTime;
        const progress = Math.min(elapsed / duration, 1);

        // Ease out cubic for smooth deceleration
        const easeOut = 1 - Math.pow(1 - progress, 3);
        const currentValue = targetNum * easeOut;

        if (isDecimal) {
          el.textContent = currentValue.toFixed(decimalPlaces);
        } else {
          el.textContent = Math.round(currentValue).toString();
        }

        if (progress < 1) {
          requestAnimationFrame(update);
        } else {
          // Ensure final value is exact
          el.textContent = targetStr;
        }
      }

      requestAnimationFrame(update);
    }

    /**
     * IntersectionObserver to trigger animation when stats come into view
     */
    const observer = new IntersectionObserver(
      (entries) => {
        entries.forEach((entry) => {
          if (entry.isIntersecting) {
            // Find which stat this is and animate if not already done
            const statCard = entry.target.closest('.stat-card');
            if (!statCard) return;

            const valueEl = statCard.querySelector('.stat-value');
            if (!valueEl) return;

            const statData = statsData.find((s) => s.el === valueEl);
            if (statData && !statData.animated) {
              statData.animated = true;
              // Stagger animation based on index
              const index = statsData.indexOf(statData);
              setTimeout(() => {
                animateValue(statData.el, statData.target, 1200);
              }, index * 150);
            }
          }
        });
      },
      { threshold: 0.5, rootMargin: '0px 0px -50px 0px' }
    );

    // Observe each stat card
    document.querySelectorAll('.stat-card').forEach((card) => {
      observer.observe(card);
    });

    // Cleanup for SPA navigation
    document.addEventListener('astro:before-preparation', () => {
      observer.disconnect();
    });
  })();
</script>
